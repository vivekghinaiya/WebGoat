trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - '*'

pool:
  vmImage: 'ubuntu-latest'

steps:

# 🔐 1. Gitleaks – Secret Detection
- script: |
    echo "Installing Gitleaks..."
    curl -sSL https://github.com/gitleaks/gitleaks/releases/latest/download/gitleaks-linux-amd64 -o gitleaks
    chmod +x gitleaks

    echo "Running Gitleaks scan on WebGoat..."
    ./gitleaks detect \
      --source . \
      --report-format sarif \
      --report-path gitleaks-report.sarif \
      --exit-code 1
  displayName: 'Run Gitleaks Secret Scan'

# 📄 2. Publish the SARIF report
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'gitleaks-report.sarif'
    ArtifactName: 'gitleaks-report'
